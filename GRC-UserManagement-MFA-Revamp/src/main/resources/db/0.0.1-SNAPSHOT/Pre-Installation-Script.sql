--1
CREATE TABLE CNFG_USER_GROUP(
    V_GROUP_ID VARCHAR2(100) PRIMARY KEY, --instead of AI we can give an abbr. of the Group Name
    V_GROUP_NAME VARCHAR2(100),
    V_GROUP_DESC VARCHAR2(500),
    V_LANDING_PAGE VARCHAR2(100), --this can be a FK refering to Menu table
    D_CREATED date,
    V_CREATED_BY VARCHAR2(20), --this can be a FK refering to Users table
    D_LAST_UPDATED date
);
--2
CREATE TABLE "CNFG_USERS" 
   (	"V_USER_ID" VARCHAR2(20 CHAR) PRIMARY KEY, 
	"V_USERNAME" VARCHAR2(250 BYTE), 
	"V_PASSWORD" VARCHAR2(200 CHAR), 
	"N_ENABLED" FLOAT(126), 
	"V_ACCOUNT_ACTIVE" CHAR, --Y/N  Status:Activate/deactivate
    "V_ACCOUNT_DELETED" CHAR, --Y/N  whats the diff. wrt. the above field?
	"V_HOME_PAGE" VARCHAR2(50 CHAR), 
	"V_LOCALE" VARCHAR2(2 CHAR), 
	"V_EMAIL" VARCHAR2(100 CHAR), 
	"V_ADDRESS" VARCHAR2(200 CHAR), 
	"V_PHONE" VARCHAR2(20 CHAR), 
	"D_PASSWORD_CHANGED_DATE" DATE, 
	"N_SESSION_TIME" FLOAT(126), 
	"N_ALLOWED_ATTEMPT" FLOAT(126), 
	"N_PASS_EXPIRY_DAYS" FLOAT(126), 
	"V_PASSWORD2" VARCHAR2(200 CHAR), 
	"V_PASSWORD3" VARCHAR2(200 CHAR), 
	"N_FAILED_ATTEMPT" FLOAT(126), 
	"D_LAST_LOGIN" DATE, 
	"N_DEFAULT_DASHBOARD" FLOAT(126), 
	"V_DEPARTMENT" VARCHAR2(30 CHAR), 
	"V_DEPARTMENT_TYPE" VARCHAR2(30 CHAR), 
	"V_REPORT_CURRENCY" VARCHAR2(30 CHAR), 
	"N_REPORT_UNIT" NUMBER(30,0), 
	"V_OTP_ENABLED" VARCHAR2(50 CHAR), 
	"V_BUSINESS_SEGMENT" VARCHAR2(250 BYTE), 
	"V_PRIMARY_BRANCH_CODE" VARCHAR2(10 BYTE), 
	"V_BRANCH_CODE" VARCHAR2(60 BYTE), --diff
    "V_BRANCH_NAME" VARCHAR2(200), -- +
	"LOCATION" VARCHAR2(60 BYTE), 
	"REGION" VARCHAR2(60 BYTE), 
	"ZONE" VARCHAR2(60 BYTE), 
	"GRADE" VARCHAR2(25 BYTE),
	"V_USER_LEVEL" VARCHAR2(5 BYTE), 
	"V_MANAGER_ID" VARCHAR2(20 BYTE), 
	"D_CREATED" DATE, 
	"D_LAST_UPDATED" DATE,
    "V_GROUP_ID" VARCHAR2(100) REFERENCES CNFG_USER_GROUP -- +
   ) ;

--3
CREATE TABLE CNFG_MENU(
    V_MENU_ID VARCHAR2(20),
    V_MENU_NAME VARCHAR2(100),
    V_SUB_MENU_NAME VARCHAR2(200), --assuming there will only 2 levels
    V_RW_ACCESS CHAR, --can be either R/W R for only read, and W for both read/write
    V_ROLE_NAME VARCHAR2(100) PRIMARY KEY
);

--4
CREATE TABLE CNFG_GROUP_ROLES(
    V_ROLE_NAME VARCHAR2(100) REFERENCES CNFG_MENU,
    V_GROUP_ID VARCHAR2(100) REFERENCES CNFG_USER_GROUP,
    PRIMARY KEY(V_GROUP_ID, V_ROLE_NAME)
);

--5
CREATE TABLE UM_AUDIT_LOG 
(	"N_AUDIT_CD" NUMBER GENERATED BY DEFAULT ON NULL AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE ,
    "V_USER_ID" VARCHAR2(20), 
    "V_ACTION" VARCHAR2(200), 
    "V_IP_ADDRESS" VARCHAR2(30), 
    "T_TIME" TIMESTAMP, 
    "V_MSG" VARCHAR2(500),
    "V_ACTION_RESULT" VARCHAR2(4000 CHAR)
);

--comment on table cnfg_menu is 'screen and roles will be mapped';

CREATE TABLE "CNFG_PASSWORD_RESET_TOKEN" 
   (	"V_TOKEN" VARCHAR2(2000 BYTE) NOT NULL ENABLE, 
	"D_EXPIRY" TIMESTAMP (6) NOT NULL ENABLE, 
	"V_USER_ID" VARCHAR2(2000 BYTE) NOT NULL ENABLE, 
	 CONSTRAINT "CNFG_PASSWORD_RESET_TOKEN_PK" PRIMARY KEY ("V_TOKEN"), 
	 CONSTRAINT "CNFG_PASSWORD_RESET_TOKEN_FK1" FOREIGN KEY ("V_USER_ID")
	  REFERENCES "CNFG_USERS" ("V_USER_ID") ENABLE
   );
   
   
CREATE TABLE "CNFG_PROPERTY_DETAILS" 
  ( "N_CNFG_ID" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  NOT NULL ENABLE, 
	"V_CNFG_KEY" VARCHAR2(2000 BYTE) NOT NULL ENABLE, 
	"V_CNFG_VALUE" VARCHAR2(2000 BYTE) NOT NULL ENABLE, 
	"V_CNFG_NAME" VARCHAR2(2000 BYTE) NOT NULL ENABLE, 
	 CONSTRAINT "CNFG_PROPERTY_DETAILS_PK" PRIMARY KEY ("N_CNFG_ID")
  );   
  
  
CREATE TABLE CNFG_USER_PREFERNCES(
    V_USER_ID VARCHAR2(200),
    V_PAGE VARCHAR2(200),
	V_COLUMN_PREFERNCES VARCHAR2(4000),
    PRIMARY KEY(V_USER_ID, V_PAGE)
);
   

-- Pre installation script --
-- Insert default menu --

Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('1','Group','Group ','R','ROLE_GROUP_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('2','Group','Group','W','ROLE_GROUP_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('3','User','User','R','ROLE_USER_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('4','User','User','W','ROLE_USER_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('5','Config','Config','R','ROLE_CNFG_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('6','Config','Config','W','ROLE_CNFG_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('7','Analytics','Analytics','R','ROLE_ANALYTICS_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('8','Analytics','Analytics','W','ROLE_ANALYTICS_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('9','Workflow','Workflow','R','ROLE_WORKFLOW_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('10','Workflow','Workflow','W','ROLE_WORKFLOW_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('11','Library','Library','R','ROLE_LIBRARY_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('12','Library','Library','W','ROLE_LIBRARY_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('13','Operations','Operations','R','ROLE_OPERATIONS_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('14','Operations','Operations','W','ROLE_OPERATIONS_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('15','Risk Library','Risk Library','R','ROLE_RISKLIBRARY_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('16','Risk Library','Risk Library','W','ROLE_RISKLIBRARY_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('17','Control Library','Control Library','R','ROLE_CONTROLLIBRARY_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('18','Control Library','Control Library','W','ROLE_CONTROLLIBRARY_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('19','Admin','Admin','R','ROLE_ADMIN_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('20','Admin','Admin','W','ROLE_ADMIN_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('21','Risk Register','Risk Register','R','ROLE_RISKREGISTER_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('22','Risk Register','Risk Register','W','ROLE_RISKREGISTER_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('23','Key Risk Indicators','Key Risk Indicators','R','ROLE_KRI_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('24','Key Risk Indicators','Key Risk Indicators','W','ROLE_KRI_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('25','Risk Monitoring','Risk Monitoring','R','ROLE_RISKMONITORING_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('26','Risk Monitoring','Risk Monitoring','W','ROLE_RISKMONITORING_WRITE');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('27','rt 360 View','rt 360 View','R','ROLE_RT360_READ');
Insert into CNFG_MENU (V_MENU_ID,V_MENU_NAME,V_SUB_MENU_NAME,V_RW_ACCESS,V_ROLE_NAME) values ('28','rt 360 View','rt 360 View','W','ROLE_RT360_WRITE');
commit;

-- Insert default cnfg_user_group --
Insert into CNFG_USER_GROUP (V_GROUP_ID,V_GROUP_NAME,V_GROUP_DESC,V_LANDING_PAGE,D_CREATED,V_CREATED_BY,D_LAST_UPDATED) values ('1','Admin Group','Admin Group','Group page',SYSDATE,'SuperUser',SYSDATE);
commit;


-insert default cnfg_user_roles---
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_ANALYTICS_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_ANALYTICS_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_CNFG_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_CNFG_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RT360_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RT360_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_LIBRARY_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_LIBRARY_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKLIBRARY_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKLIBRARY_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_CONTROLLIBRARY_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_CONTROLLIBRARY_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_ADMIN_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_ADMIN_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKREGISTER_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKREGISTER_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_KRI_READ_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_KRI_READ_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKMONITORING_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_RISKMONITORING_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_GROUP_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_GROUP_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_OPERATIONS_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_OPERATIONS_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_USER_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_USER_WRITE','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_WORKFLOW_READ','1');
Insert into CNFG_GROUP_ROLES (V_ROLE_NAME,V_GROUP_ID) values ('ROLE_WORKFLOW_WRITE','1');
commit;

-- Insert SuperUser --
Insert into CNFG_USERS (V_USER_ID,V_USERNAME,V_PASSWORD,V_ACCOUNT_ACTIVE,V_ACCOUNT_DELETED,V_HOME_PAGE,V_LOCALE,V_EMAIL,V_ADDRESS,V_PHONE,D_PASSWORD_CHANGED_DATE,N_SESSION_TIME,N_ALLOWED_ATTEMPT,N_PASS_EXPIRY_DAYS,V_PASSWORD2,V_PASSWORD3,N_FAILED_ATTEMPT,D_LAST_LOGIN,N_DEFAULT_DASHBOARD,V_DEPARTMENT,V_DEPARTMENT_TYPE,V_REPORT_CURRENCY,N_REPORT_UNIT,V_OTP_ENABLED,V_BUSINESS_SEGMENT,V_PRIMARY_BRANCH_CODE,V_BRANCH_CODE,V_BRANCH_NAME,LOCATION,REGION,ZONE,GRADE,V_GROUP_ID, D_CREATED, D_LAST_UPDATED) values ('GRCSuperUser','SuperUser','$2a$10$uwAaWvAg9czfRT4dDMSrfOhgnapE9k4rx4qyDb7zIYLpC1iGjg7Kq','Y','N','Group',null,'test@mail.com',null,null,null,0,0,0,null,null,0,null,0,'ADMIN','ADMIN','INR',0,null,null,null,null,null,null,null,null,null,'1',SYSDATE, SYSDATE);
commit;

-- insert cnfg details--
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('spring.datasource.username','admin','db');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('spring.datasource.password','bahwan$123','db');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('auth.type','db','config');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('ldap.urls','ldap://localhost:10389/','ldap');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('ldap.domain','dc=example,dc=com','ldap');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('ldap.base','(&(objectClass=*)(cn= {0}))','ldap');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('user.session.timeout','100','session');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('license.user.count','1000','license');
Insert into CNFG_PROPERTY_DETAILS (V_CNFG_KEY,V_CNFG_VALUE,V_CNFG_NAME) values ('user.grade.list','G1,G2,G3,G4','grade');
commit;
